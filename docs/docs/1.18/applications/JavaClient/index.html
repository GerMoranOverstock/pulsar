<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -108) };
  window.addEventListener("hashchange", shiftWindow);
  window.addEventListener("pageshow", shiftWindow);
  function load() { if (window.location.hash) shiftWindow(); }
</script>

<title>The Pulsar Java client</title>

<link rel="stylesheet" href="/incubator-pulsar/css/style.css">
<link rel="shortcut icon" href="/incubator-pulsar/img/favicon.ico">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/incubator-pulsar/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script async src="/incubator-pulsar/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <header class="container-fluid sticky-top top-nav">
        <nav class="navbar navbar-default navbar-toggleable-xl container">
  <a class="navbar-brand" href="/incubator-pulsar/">
    <img src="/incubator-pulsar/img/pulsar-logo.png">
  </a>

  <div class="collapse navbar-collapse justify-content-end" id="nav-content">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsar/docs/1.18">Documentation</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsar/docs/1.18/getting-started/Clients">Client libraries</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsar/ja"><img class="japan-flag" src="/incubator-pulsar/img/japan-flag.svg"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/yahoo/pulsar"><i class="fa fa-github fa-lg"></i></a>
      </li>
      <li class="nav-item version">
        <a class="nav-link">Pulsar 1.18</a>
      </li>
    </ul>
  </div>
</nav>

      </header>

      <main>
        <div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-sm-down col-md-3 col-lg-3">
      
<ul class="sidebar">
  
  <section class="sidebar-group">
    <h4>Getting started</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/getting-started/LocalCluster/"><i class="fa fa-file-text-o"></i>Run Pulsar locally</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/getting-started/Clients/"><i class="fa fa-file-text-o"></i>Client libraries</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/getting-started/ConceptsAndArchitecture/"><i class="fa fa-file-text-o"></i>Concepts and architecture</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Deployment</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/deployment/InstanceSetup/"><i class="fa fa-file-text-o"></i>Deploying up a Pulsar instance</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/deployment/Kubernetes/"><i class="fa fa-file-text-o"></i>Pulsar on Kubernetes</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Concerns</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/concerns/PartitionedTopics/"><i class="fa fa-file-text-o"></i>Partitioned topics</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/concerns/RetentionExpiry/"><i class="fa fa-file-text-o"></i>Retention and expiry</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Pulsar administration</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/AdminInterface/"><i class="fa fa-file-text-o"></i>Pulsar admin interface</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/ClustersBrokers/"><i class="fa fa-file-text-o"></i>Clusters and brokers</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/PropertiesNamespaces/"><i class="fa fa-file-text-o"></i>Properties and namespaces</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/ZooKeeperBookKeeper/"><i class="fa fa-file-text-o"></i>ZooKeeper and BookKeeper</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/Dashboard/"><i class="fa fa-file-text-o"></i>Dashboard</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/Authz/"><i class="fa fa-file-text-o"></i>Authentication and authorization</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/GeoReplication/"><i class="fa fa-file-text-o"></i>Geo-replication</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/Stats/"><i class="fa fa-file-text-o"></i>Pulsar statistics</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/admin/ModularLoadManager/"><i class="fa fa-file-text-o"></i>Modular load manager</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Pulsar applications</h4>
    <ul>
      
      
      
      <li><a  class="active"href="/incubator-pulsar/docs/1.18/applications/JavaClient/"><i class="fa fa-file-text-o"></i>The Pulsar Java client</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/CppClient/"><i class="fa fa-file-text-o"></i>The Pulsar C++ client</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/PythonClient/"><i class="fa fa-file-text-o"></i>The Pulsar Python client</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/WebSocket/"><i class="fa fa-file-text-o"></i>WebSocket API</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/PulsarSpark/"><i class="fa fa-file-text-o"></i>Spark Streaming receiver</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/PulsarStorm/"><i class="fa fa-file-text-o"></i>Apache Storm adaptor</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/applications/SimulationTools/"><i class="fa fa-file-text-o"></i>Simulation tools</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Developing Pulsar</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/project/BinaryProtocol/"><i class="fa fa-file-text-o"></i>Pulsar binary protocol</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/project/Codebase/"><i class="fa fa-file-text-o"></i>Codebase</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Reference</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/reference/RestApi/"><i class="fa fa-file-text-o"></i>Pulsar REST API</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/reference/CliTools/"><i class="fa fa-file-text-o"></i>Command-line tools</a></li>
      
      
      
      <li><a href="/incubator-pulsar/docs/1.18/reference/Configuration/"><i class="fa fa-file-text-o"></i>Pulsar configuration</a></li>
      
    </ul>
  </section>
  
</ul>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-7 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">The Pulsar Java client</h1>
        
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">client</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-client">client</button>
          <div class="modal fade" id="modal-client">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>client</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/reference/CliTools/">Pulsar command-line tools</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/applications/CppClient/">The Pulsar C++ client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/applications/JavaClient/">The Pulsar Java client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/applications/PythonClient/">The Pulsar Python client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">java</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-java">java</button>
          <div class="modal fade" id="modal-java">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>java</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/docs/1.18/admin/AdminInterface/">The Pulsar admin interface</a></li>
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/admin/Authz/">Authentication and authorization in Pulsar</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/applications/JavaClient/">The Pulsar Java client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.18/applications/PulsarSpark/">Spark Streaming Pulsar receiver</a></li>
          
          
          
          
          
          <li><a href="/docs/1.18/applications/PulsarStorm/">Pulsar adaptor for Apache Storm</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <p>The Pulsar Java client can be used both to create Java <span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producers</span> and <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumers</span> of messages but also to perform <a href="../../admin/AdminInterface">administrative tasks</a>.</p>

<p>The current version of the Java client is <strong>1.18</strong>.</p>

<p>Javadoc for the Pulsar client is divided up into three domains, by package:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Package</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="/incubator-pulsar/api/client"><code class="highlighter-rouge">com.yahoo.pulsar.client.api</code></a></td>
      <td style="text-align: left">The <span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producer</span> and <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumer</span> API</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="/incubator-pulsar/api/admin"><code class="highlighter-rouge">com.yahoo.pulsar.client.admin</code></a></td>
      <td style="text-align: left">The Java <a href="../../admin/AdminInterface">admin API</a></td>
    </tr>
  </tbody>
</table>

<p>This document will focus only on the client API for producing and consuming messages on Pulsar <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topics</span>.</p>

<h2 id="installation">Installation</h2>

<p>The latest version of the Pulsar Java client library is available via <a href="http://search.maven.org/#artifactdetails%7Ccom.yahoo.pulsar%7Cpulsar-client%7C1.18%7Cjar">Maven Central</a>. To use the latest version, add the <code class="highlighter-rouge">pulsar-client</code> library to your build configuration.</p>

<h3 id="maven">Maven</h3>

<p>If you’re using Maven, add this to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- in your &lt;properties&gt; block --&gt;</span>
<span class="nt">&lt;pulsar.version&gt;</span>1.18<span class="nt">&lt;/pulsar.version&gt;</span>

<span class="c">&lt;!-- in your &lt;dependencies&gt; block --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.yahoo.pulsar<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>pulsar-client<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${pulsar.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<h3 id="gradle">Gradle</h3>

<p>If you’re using Gradle, add this to your <code class="highlighter-rouge">build.gradle</code> file:</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'com.yahoo.pulsar'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'pulsar-client'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'1.18'</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="client-configuration">Client configuration</h2>

<p>You can instantiate a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/PulsarClient.html"><code class="highlighter-rouge">PulsarClient</code></a> object using just a URL for the target Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span>, like this:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">pulsarBrokerRootUrl</span> <span class="o">=</span> <span class="s">"pulsar://localhost:6650"</span><span class="o">;</span>
<span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">pulsarBrokerRootUrl</span><span class="o">);</span>
</code></pre>
</div>

<p>This object will use the default configuration.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the authentication provider to use in the Pulsar client instance</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthentication</span><span class="o">(</span><span class="n">Authentication</span> <span class="n">authentication</span><span class="o">);</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthentication</span><span class="o">(</span><span class="n">String</span> <span class="n">authPluginClassName</span><span class="o">,</span> <span class="n">String</span> <span class="n">authParamsString</span><span class="o">);</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthentication</span><span class="o">(</span><span class="n">String</span> <span class="n">authPluginClassName</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">authParams</span><span class="o">);</span>

<span class="c1">// Set the operation timeout(default: 30 seconds)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOperationTimeout</span><span class="o">(</span><span class="kt">int</span> <span class="n">operationTimeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

<span class="c1">// Set the number of threads to be used for handling connections to brokers (default: 1 thread)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIoThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">numIoThreads</span><span class="o">);</span>

<span class="c1">// Set the number of threads to be used for message listeners(default: 1 thread)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setListenerThreads</span><span class="o">(</span><span class="kt">int</span> <span class="n">numListenerThreads</span><span class="o">);</span>

<span class="c1">// Sets the max number of connection that the client library will open to a single broker</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setConnectionsPerBroker</span><span class="o">(</span><span class="kt">int</span> <span class="n">connectionsPerBroker</span><span class="o">);</span>

<span class="c1">// Configure whether to use TCP no-delay flag on the connection, to disable the Nagle algorithm</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUseTcpNoDelay</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">useTcpNoDelay</span><span class="o">);</span>
</code></pre>
</div>

<div class="admonition">
  <div class="info">
    
    
<p>In addition to client-level configuration, you can also apply <a href="#configuring-producers">producer</a>- and <a href="#configuring-consumers">consumer</a>-specific configuration.</p>

  </div>
</div>

<h2 id="producers">Producers</h2>

<p>In Pulsar, <span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producers</span> point to a Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> and write <span class="popover-term" tabindex="0" title="What is a message in Pulsar?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">messages</span> to <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topics</span>. You can instantiate a new popover producer  by first instantiating a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/PulsarClient.html"><code class="highlighter-rouge">PulsarClient</code></a>, passing it a URL for a Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">pulsarBrokerRootUrl</span> <span class="o">=</span> <span class="s">"pulsar://localhost:6650"</span><span class="o">;</span>
<span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">pulsarBrokerRootUrl</span><span class="o">);</span>
</code></pre>
</div>

<div class="admonition">
  <div class="info">
    <span class="admonition-title"><p>Default broker URLs for standalone clusters</p>
</span>
    
<p>If you’re running a cluster in <a href="../getting-started/LocalCluster">standalone mode</a>, the broker will be available at these two URLs by default:</p>

<ul>
  <li><code class="highlighter-rouge">pulsar://localhost:6650</code></li>
  <li><code class="highlighter-rouge">http://localhost:8080</code></li>
</ul>

  </div>
</div>

<p>Once you’ve instantiated a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/PulsarClient.html"><code class="highlighter-rouge">PulsarClient</code></a> object, you can create a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/Producer.html"><code class="highlighter-rouge">Producer</code></a> for a <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topic</span>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">topic</span> <span class="o">=</span> <span class="s">"persistent://sample/standalone/ns1/my-topic"</span><span class="o">;</span>
<span class="n">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">createProducer</span><span class="o">(</span><span class="n">topic</span><span class="o">);</span>
</code></pre>
</div>

<p>You can then send messages to the broker and topic you specified:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Publish 10 messages to the topic</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"my-message"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="admonition">
  <div class="warning">
    
    
<p>You should always make sure to close your producer, consumer, and client when no longer needed:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">consumer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre>
</div>

<p>Closer operations can also be asynchronous:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">producer</span><span class="o">.</span><span class="na">asyncClose</span><span class="o">();</span>
<span class="n">consumer</span><span class="o">.</span><span class="na">asyncClose</span><span class="o">();</span>
<span class="n">clioent</span><span class="o">.</span><span class="na">asyncClose</span><span class="o">();</span>
</code></pre>
</div>

  </div>
</div>

<h3 id="configuring-producers">Configuring producers</h3>

<p>If you instantiate a <code class="highlighter-rouge">Producer</code> object specifying only a topic name, as in the example above, the producer will use the default configuration. To use a non-default configuration, you can instantiate the <code class="highlighter-rouge">Producer</code> with a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/ProducerConfiguration.html"><code class="highlighter-rouge">ProducerConfiguration</code></a> object as well. The following setters are available:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the send timeout (default: 30 seconds)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSendTimeout</span><span class="o">(</span><span class="kt">int</span> <span class="n">sendTimeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

<span class="c1">// Set the max size of the queue holding the messages pending to receive an acknowledgment from the broker.</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMaxPendingMessages</span><span class="o">(</span><span class="kt">int</span> <span class="n">maxPendingMessages</span><span class="o">);</span>

<span class="c1">// Set whether the Producer#send and Producer#sendAsync operations should block when the outgoing message queue is full.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBlockIfQueueFull</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">blockIfQueueFull</span><span class="o">);</span>

<span class="c1">// Set the message routing mode for the partitioned producer</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessageRoutingMode</span><span class="o">(</span><span class="n">MessageRoutingMode</span> <span class="n">messageRouteMode</span><span class="o">);</span>

<span class="c1">// Set the compression type for the producer.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompressionType</span><span class="o">(</span><span class="n">CompressionType</span> <span class="n">compressionType</span><span class="o">);</span>

<span class="c1">// Set a custom message routing policy by passing an implementation of MessageRouter</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessageRouter</span><span class="o">(</span><span class="n">MessageRouter</span> <span class="n">messageRouter</span><span class="o">);</span>

<span class="c1">// Control whether automatic batching of messages is enabled for the producer, default: false.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBatchingEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">batchMessagesEnabled</span><span class="o">);</span>

<span class="c1">// Set the time period within which the messages sent will be batched, default: 10ms.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBatchingMaxPublishDelay</span><span class="o">(</span><span class="kt">long</span> <span class="n">batchDelay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">timeUnit</span><span class="o">);</span>

<span class="c1">// Set the maximum number of messages permitted in a batch, default: 1000.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBatchingMaxMessages</span><span class="o">(</span><span class="kt">int</span> <span class="n">batchMessagesMaxMessagesPerBatch</span><span class="o">);</span>
</code></pre>
</div>

<p>Here’s a configuration example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">pulsarBrokerRootUrl</span><span class="o">);</span>
<span class="n">ProducerConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfiguration</span><span class="o">();</span>
<span class="n">config</span><span class="o">.</span><span class="na">setIoThreads</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setUseTcpNoDelay</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">createProducer</span><span class="o">(</span><span class="n">topic</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="message-routing">Message routing</h3>

<p>When using <span class="popover-term" tabindex="0" title="What is a partitioned topic?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">partitioned topics</span>, you can specify the routing mode whenever you publish messages using a <span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producer</span>. For more on specifying a routing mode using the Java client, see the <a href="../../concerns/PartitionedTopics">Partitioned Topics</a> guide.</p>

<h3 id="async-send">Async send</h3>

<p>You can publish messages <a href="../../getting-started/ConceptsAndArchitecture#send-modes">asynchronously</a> using the Java client. With async send, the producer will put the message in a blocking queue and return immediately. The client library will then send the message to the <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> in the background. If the queue is full (max size configurable), the producer could be blocked or fail immediately when calling the API, depending on arguments passed to the producer.</p>

<p>Here’s an example async send operation:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">producer</span><span class="o">.</span><span class="na">sendAsync</span><span class="o">(</span><span class="s">"my-async-message"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</code></pre>
</div>

<h2 id="consumers">Consumers</h2>

<p>In Pulsar, <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumers</span> subscribe to <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topics</span> and handle <span class="popover-term" tabindex="0" title="What is a message in Pulsar?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">messages</span> that <span class="popover-term" tabindex="0" title="What is a producer?" data-placement="top" data-content="A process that publishes messages to a Pulsar topic." data-toggle="popover" data-trigger="focus">producers</span> publish to those topics. You can instantiate a new <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumer</span> by first instantiating a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/PulsarClient.html"><code class="highlighter-rouge">PulsarClient</code></a>, passing it a URL for a Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> (we’ll use the <code class="highlighter-rouge">client</code> object from the producer example above).</p>

<p>Once you’ve instantiated a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/PulsarClient.html"><code class="highlighter-rouge">PulsarClient</code></a> object, you can create a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/Consumer.html"><code class="highlighter-rouge">Consumer</code></a> for a <span class="popover-term" tabindex="0" title="What is a topic?" data-placement="top" data-content="A named channel used to pass messages published by producers to consumers who process those messages." data-toggle="popover" data-trigger="focus">topic</span>. You also need to supply a <span class="popover-term" tabindex="0" title="What is a subscription?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">subscription</span> name.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">topic</span> <span class="o">=</span> <span class="s">"persistent://sample/standalone/ns1/my-topic"</span><span class="o">;</span> <span class="c1">// from above</span>
<span class="n">String</span> <span class="n">subscription</span> <span class="o">=</span> <span class="s">"my-subscription"</span><span class="o">;</span>
<span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">topic</span><span class="o">,</span> <span class="n">subscription</span><span class="o">);</span>
</code></pre>
</div>

<p>You can then use the <code class="highlighter-rouge">receive</code> method to listen for messages on the topic. This <code class="highlighter-rouge">while</code> loop sets up a long-running listener for the <code class="highlighter-rouge">persistent://sample/standalone/ns1/my-topic</code> topic, prints the contents of any message that’s received, and then <span class="popover-term" tabindex="0" title="What is an acknowledgement (ack)?" data-placement="top" data-content="A message sent to a Pulsar broker by a consumer that a message has been successfully processed. An acknowledgement (ack) is Pulsar's way of knowing that the message can be deleted from the system; if no acknowledgement, then the message will be retained until it's processed." data-toggle="popover" data-trigger="focus">acknowledges</span> that the message has been processed:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Wait for a message</span>
  <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">consumer</span><span class="o">.</span><span class="na">receive</span><span class="o">();</span>

  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Received message: "</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>

  <span class="c1">// Acknowledge the message so that it can be deleted by broker</span>
  <span class="n">consumer</span><span class="o">.</span><span class="na">acknowledge</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="configuring-consumers">Configuring consumers</h3>

<p>If you instantiate a <code class="highlighter-rouge">Consumer</code> object specifying only a topic and subscription name, as in the example above, the consumer will use the default configuration. To use a non-default configuration, you can instantiate the <code class="highlighter-rouge">Consumer</code> with a <a target="_blank" href="/api/client/com/yahoo/pulsar/client/api/ConsumerConfiguration.html"><code class="highlighter-rouge">ConsumerConfiguration</code></a> object as well. The following setters are available:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Set the timeout for unacked messages, truncated to the nearest millisecond</span>
<span class="kd">public</span> <span class="n">ConsumerConfiguration</span> <span class="nf">setAckTimeout</span><span class="o">(</span><span class="kt">long</span> <span class="n">ackTimeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">timeUnit</span><span class="o">);</span>

<span class="c1">// Select the subscription type to be used when subscribing to the topic</span>
<span class="kd">public</span> <span class="n">ConsumerConfiguration</span> <span class="nf">setSubscriptionType</span><span class="o">(</span><span class="n">SubscriptionType</span> <span class="n">subscriptionType</span><span class="o">);</span>

<span class="c1">// Sets a MessageListener for the consumer</span>
<span class="kd">public</span> <span class="n">ConsumerConfiguration</span> <span class="nf">setMessageListener</span><span class="o">(</span><span class="n">MessageListener</span> <span class="n">messageListener</span><span class="o">);</span>

<span class="c1">// Sets the size of the consumer receive queue</span>
<span class="kd">public</span> <span class="n">ConsumerConfiguration</span> <span class="nf">setReceiverQueueSize</span><span class="o">(</span><span class="kt">int</span> <span class="n">receiverQueueSize</span><span class="o">);</span>
</code></pre>
</div>

<p>Here’s an example configuration:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">pulsarBrokerRootUrl</span><span class="o">);</span>
<span class="n">ConsumerConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsumerConfiguration</span><span class="o">();</span>
<span class="n">config</span><span class="o">.</span><span class="na">setSubscriptionType</span><span class="o">(</span><span class="n">SubscriptionType</span><span class="o">.</span><span class="na">Shared</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setReceiverQueueSize</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
<span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">createConsumer</span><span class="o">(</span><span class="n">topic</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="async-receive">Async receive</h3>

<p>The <code class="highlighter-rouge">receive</code> method will receive messages synchronously (the consumer process will be blocked until a message is available). You can also use <a href="../../getting-started/ConceptsAndArchitecture#receive-modes">async receive</a>, which will return immediately with a <a href="http://www.baeldung.com/java-completablefuture"><code class="highlighter-rouge">CompletableFuture</code></a> object that completes once a new message is available.</p>

<p>Here’s an example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">asyncMessage</span> <span class="o">=</span> <span class="n">consumer</span><span class="o">.</span><span class="na">receiveAsync</span><span class="o">();</span>
</code></pre>
</div>

<h2 id="authentication">Authentication</h2>

<p>Pulsar currently supports two authentication schemes: <a href="../../admin/Authz#tls-authentication">TLS</a> and <a href="../../admin/Authz#athenz">Athenz</a>. The Pulsar Java client can be used with both.</p>

<h3 id="tls-authentication">TLS Authentication</h3>

<p>To use <a href="../../admin/Authz#tls-authentication">TLS</a>, you need to set TLS to <code class="highlighter-rouge">true</code> using the <code class="highlighter-rouge">setUseTls</code> method, point your Pulsar client to a TLS cert path, and provide paths to cert and key files. Here’s an example configuration:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ClientConfiguration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClientConfiguration</span><span class="o">();</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setUseTls</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setTlsTrustCertsFilePath</span><span class="o">(</span><span class="s">"/path/to/cacert.pem"</span><span class="o">);</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">authParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tlsCertFile"</span><span class="o">,</span> <span class="s">"/path/to/client-cert.pem"</span><span class="o">);</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tlsKeyFile"</span><span class="o">,</span> <span class="s">"/path/to/client-key.pem"</span><span class="o">);</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">AuthenticationTls</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">authParams</span><span class="o">);</span>

<span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
                        <span class="s">"pulsar+ssl://my-broker.com:6651"</span><span class="o">,</span> <span class="n">conf</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="athenz">Athenz</h3>

<p>To use <a href="../../admin/Authz#athenz">Athenz</a> as an authentication provider, you need to <a href="#tls-authentication">use TLS</a> and provide values for four parameters in a hash:</p>

<ul>
  <li><code class="highlighter-rouge">tenantDomain</code></li>
  <li><code class="highlighter-rouge">tenantService</code></li>
  <li><code class="highlighter-rouge">providerDomain</code></li>
  <li><code class="highlighter-rouge">privateKeyPath</code></li>
</ul>

<p>You can also set an optional <code class="highlighter-rouge">keyId</code>. Here’s an example configuration:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">ClientConfiguration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClientConfiguration</span><span class="o">();</span>

<span class="c1">// Enable TLS</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setUseTls</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setTlsTrustCertsFilePath</span><span class="o">(</span><span class="s">"/path/to/cacert.pem"</span><span class="o">);</span>

<span class="c1">// Set Athenz auth plugin and its parameters</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">authParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tenantDomain"</span><span class="o">,</span> <span class="s">"shopping"</span><span class="o">);</span> <span class="c1">// Tenant domain name</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tenantService"</span><span class="o">,</span> <span class="s">"some_app"</span><span class="o">);</span> <span class="c1">// Tenant service name</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"providerDomain"</span><span class="o">,</span> <span class="s">"pulsar"</span><span class="o">);</span> <span class="c1">// Provider domain name</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"privateKeyPath"</span><span class="o">,</span> <span class="s">"/path/to/private.pem"</span><span class="o">);</span> <span class="c1">// Tenant private key path</span>
<span class="n">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"keyId"</span><span class="o">,</span> <span class="s">"v1"</span><span class="o">);</span> <span class="c1">// Key id for the tenant private key (optional, default: "0")</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">AuthenticationAthenz</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">authParams</span><span class="o">);</span>

<span class="n">PulsarClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">PulsarClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
        <span class="s">"pulsar+ssl://my-broker.com:6651"</span><span class="o">,</span> <span class="n">conf</span><span class="o">);</span>
</code></pre>
</div>

      </section>
    </article>

    <nav class="toc-bar hidden-sm-down col-md-2 col-lg-2">
      
      <div id="toc">
        <h4>The Pulsar Java client</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <footer class="footer">
  <div class="container">
    <p class="text-center">&copy; Apache Foundation 2017</p>
  </div>
</footer>


    
  </body>
</html>
