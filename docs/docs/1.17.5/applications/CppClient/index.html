<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -108) };
  window.addEventListener("hashchange", shiftWindow);
  window.addEventListener("pageshow", shiftWindow);
  function load() { if (window.location.hash) shiftWindow(); }
</script>

<title>The Pulsar C++ client</title>

<link rel="stylesheet" href="/incubator-pulsarcss/style.css">
<link rel="shortcut icon" href="/incubator-pulsarimg/favicon.ico">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/incubator-pulsarjs/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script async src="/incubator-pulsarjs/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <header class="container-fluid sticky-top top-nav">
        <nav class="navbar navbar-default navbar-toggleable-xl container">
  <a class="navbar-brand" href="/incubator-pulsar">
    <img src="/incubator-pulsarimg/pulsar-logo.png">
  </a>

  <div class="collapse navbar-collapse justify-content-end" id="nav-content">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsardocs/1.17.5">Docs</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsarjavadoc">Java</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsarapi/cpp">C++</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsarapi/python">Python</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/incubator-pulsarja"><img class="japan-flag" src="/incubator-pulsarimg/japan-flag.svg"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/yahoo/pulsar"><i class="fa fa-github fa-lg"></i></a>
      </li>
      <li class="nav-item version">
        <a class="nav-link">Pulsar 1.17.5</a>
      </li>
    </ul>
  </div>
</nav>

      </header>

      <main>
        <div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-sm-down col-md-3 col-lg-3">
      
<ul class="sidebar">
  
  <section class="sidebar-group">
    <h4>Getting started</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/getting-started/LocalCluster/"><i class="fa fa-file-text-o"></i>Run Pulsar locally</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/getting-started/ConceptsAndArchitecture/"><i class="fa fa-file-text-o"></i>Concepts and architecture</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Deployment</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/deployment/InstanceSetup/"><i class="fa fa-file-text-o"></i>Setting up a Pulsar instance</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/deployment/Kubernetes/"><i class="fa fa-file-text-o"></i>Pulsar on Kubernetes</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Concerns</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/concerns/PartitionedTopics/"><i class="fa fa-file-text-o"></i>Partitioned topics</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/concerns/RetentionExpiry/"><i class="fa fa-file-text-o"></i>Retention and expiry</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Pulsar administration</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/AdminInterface/"><i class="fa fa-file-text-o"></i>Pulsar admin interface</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/ClustersBrokers/"><i class="fa fa-file-text-o"></i>Clusters and brokers</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/PropertiesNamespaces/"><i class="fa fa-file-text-o"></i>Properties and namespaces</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/ZooKeeperBookKeeper/"><i class="fa fa-file-text-o"></i>ZooKeeper and BookKeeper</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/Dashboard/"><i class="fa fa-file-text-o"></i>Dashboard</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/Authz/"><i class="fa fa-file-text-o"></i>Authentication and authorization</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/GeoReplication/"><i class="fa fa-file-text-o"></i>Geo-replication</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/Stats/"><i class="fa fa-file-text-o"></i>Pulsar statistics</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/admin/ModularLoadManager/"><i class="fa fa-file-text-o"></i>Modular load manager</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Pulsar applications</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/JavaClient/"><i class="fa fa-file-text-o"></i>The Pulsar Java client</a></li>
      
      
      
      <li><a  class="active"href="/incubator-pulsardocs/1.17.5/applications/CppClient/"><i class="fa fa-file-text-o"></i>The Pulsar C++ client</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/PythonClient/"><i class="fa fa-file-text-o"></i>The Pulsar Python client</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/WebSocket/"><i class="fa fa-file-text-o"></i>WebSocket API</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/PulsarSpark/"><i class="fa fa-file-text-o"></i>Spark Streaming receiver</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/PulsarStorm/"><i class="fa fa-file-text-o"></i>Apache Storm adaptor</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/applications/SimulationTools/"><i class="fa fa-file-text-o"></i>Simulation tools</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Developing Pulsar</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/project/BinaryProtocol/"><i class="fa fa-file-text-o"></i>Pulsar binary protocol</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/project/Codebase/"><i class="fa fa-file-text-o"></i>Codebase</a></li>
      
    </ul>
  </section>
  
  <section class="sidebar-group">
    <h4>Reference</h4>
    <ul>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/reference/RestApi/"><i class="fa fa-file-text-o"></i>Pulsar REST API</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/reference/CliTools/"><i class="fa fa-file-text-o"></i>Command-line tools</a></li>
      
      
      
      <li><a href="/incubator-pulsardocs/1.17.5/reference/Configuration/"><i class="fa fa-file-text-o"></i>Pulsar configuration</a></li>
      
    </ul>
  </section>
  
</ul>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-7 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">The Pulsar C++ client</h1>
        
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">client</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-client">client</button>
          <div class="modal fade" id="modal-client">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>client</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/reference/CliTools/">Pulsar command-line tools</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/applications/CppClient/">The Pulsar C++ client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/applications/JavaClient/">The Pulsar Java client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/applications/PythonClient/">The Pulsar Python client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">cpp</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-cpp">cpp</button>
          <div class="modal fade" id="modal-cpp">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>cpp</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/admin/Authz/">Authentication and authorization in Pulsar</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/1.17.5/applications/CppClient/">The Pulsar C++ client</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <!-- source: https://github.com/yahoo/pulsar/tree/master/pulsar-client-cpp -->

<div class="admonition">
  <div class="info">
    
    
<p>We welcome contributions from the open source community, kindly make sure your changes are backward compatible with gcc-4.4.7 and Boost 1.41.</p>

  </div>
</div>

<h2 id="supported-platforms">Supported platforms</h2>

<p>The Pulsar C++ client has been successfully tested on <strong>MacOS</strong> and <strong>Linux</strong>.</p>

<h2 id="system-requirements">System requirements</h2>

<p>You need to have the following installed to use the C++ client:</p>

<ul>
  <li><a href="https://cmake.org/">CMake</a></li>
  <li><a href="http://www.boost.org/">Boost</a></li>
  <li><a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> 2.6</li>
  <li><a href="https://logging.apache.org/log4cxx">Log4CXX</a></li>
  <li><a href="https://curl.haxx.se/libcurl/">libcurl</a></li>
  <li><a href="https://github.com/google/googletest">Google Test</a></li>
  <li><a href="https://github.com/open-source-parsers/jsoncpp">JsonCpp</a></li>
</ul>

<h2 id="compilation">Compilation</h2>

<p>There are separate compilation instructions for <a href="#macos">MacOS</a> and <a href="#linux">Linux</a>. For both systems, start by cloning the Pulsar repository:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git clone https://github.com/yahoo/pulsar/tree/master
</code></pre>
</div>

<h3 id="linux">Linux</h3>

<p>First, install all of the necessary dependencies:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>apt-get install cmake libssl-dev libcurl4-openssl-dev liblog4cxx-dev <span class="se">\</span>
  libprotobuf-dev libboost-all-dev libgtest-dev libjsoncpp-dev
</code></pre>
</div>

<p>Then compile and install <a href="https://github.com/google/googletest">Google Test</a>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git clone https://github.com/google/googletest.git <span class="o">&amp;&amp;</span> <span class="nb">cd </span>googletest
<span class="gp">$ </span>sudo cmake .
<span class="gp">$ </span>sudo make
<span class="gp">$ </span>sudo cp <span class="k">*</span>.a /usr/lib
</code></pre>
</div>

<p>Finally, compile the Pulsar client library for C++ inside the Pulsar repo:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>pulsar-client-cpp
<span class="gp">$ </span>cmake .
<span class="gp">$ </span>make
</code></pre>
</div>

<p>The resulting files, <code class="highlighter-rouge">libpulsar.so</code> and <code class="highlighter-rouge">libpulsar.a</code>, will be placed in the <code class="highlighter-rouge">lib</code> folder of the repo while two tools, <code class="highlighter-rouge">perfProducer</code> and <code class="highlighter-rouge">perfConsumer</code>, will be placed in the <code class="highlighter-rouge">perf</code> directory.</p>

<h3 id="macos">MacOS</h3>

<p>First, install all of the necessary dependencies:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># OpenSSL installation</span>
<span class="gp">$ </span>brew install openssl
<span class="gp">$ </span><span class="nb">export </span><span class="nv">OPENSSL_INCLUDE_DIR</span><span class="o">=</span>/usr/local/opt/openssl/include/
<span class="gp">$ </span><span class="nb">export </span><span class="nv">OPENSSL_ROOT_DIR</span><span class="o">=</span>/usr/local/opt/openssl/

<span class="c"># Protocol Buffers installation</span>
<span class="gp">$ </span>brew tap homebrew/versions
<span class="gp">$ </span>brew tap homebrew/versions
<span class="gp">$ </span>brew install protobuf260
<span class="gp">$ </span>brew install boost
<span class="gp">$ </span>brew install log4cxx

<span class="c"># Google Test installation</span>
<span class="gp">$ </span>git clone https://github.com/google/googletest.git
<span class="gp">$ </span><span class="nb">cd </span>googletest
<span class="gp">$ </span>cmake .
<span class="gp">$ </span>make install
</code></pre>
</div>

<p>Then compile the Pulsar client library in the repo that you cloned:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>pulsar-client-cpp
<span class="gp">$ </span>TODO
</code></pre>
</div>

<h2 id="consumer">Consumer</h2>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Client</span> <span class="n">client</span><span class="p">(</span><span class="s">"pulsar://localhost:6650"</span><span class="p">);</span>

<span class="n">Consumer</span> <span class="n">consumer</span><span class="p">;</span>
<span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"persistent://sample/standalone/ns1/my-topic"</span><span class="p">,</span> <span class="s">"my-subscribtion-name"</span><span class="p">,</span> <span class="n">consumer</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">ResultOk</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">"Failed to subscribe: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Message</span> <span class="n">msg</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">consumer</span><span class="p">.</span><span class="n">receive</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">LOG_INFO</span><span class="p">(</span><span class="s">"Received: "</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s">"  with payload '"</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="p">.</span><span class="n">getDataAsString</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"'"</span><span class="p">);</span>

    <span class="n">consumer</span><span class="p">.</span><span class="n">acknowledge</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</code></pre>
</div>

<h2 id="producer">Producer</h2>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="n">Client</span> <span class="n">client</span><span class="p">(</span><span class="s">"pulsar://localhost:6650"</span><span class="p">);</span>

<span class="n">Producer</span> <span class="n">producer</span><span class="p">;</span>
<span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">createProducer</span><span class="p">(</span><span class="s">"persistent://sample/standalone/ns1/my-topic"</span><span class="p">,</span> <span class="n">producer</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">ResultOk</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LOG_ERROR</span><span class="p">(</span><span class="s">"Error creating producer: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Publish 10 messages to the topic
</span><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">MessageBuilder</span><span class="p">().</span><span class="n">setContent</span><span class="p">(</span><span class="s">"my-message"</span><span class="p">).</span><span class="n">build</span><span class="p">();</span>
    <span class="n">Result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">producer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">LOG_INFO</span><span class="p">(</span><span class="s">"Message sent: "</span> <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</code></pre>
</div>

<h2 id="authentication">Authentication</h2>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="n">ClientConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="n">ClientConfiguration</span><span class="p">();</span>
<span class="n">config</span><span class="p">.</span><span class="n">setUseTls</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">certfile</span> <span class="o">=</span> <span class="s">"/path/to/cacert.pem"</span><span class="p">;</span>

<span class="n">ParamMap</span> <span class="n">params</span><span class="p">;</span>
<span class="n">params</span><span class="p">[</span><span class="s">"tlsCertFile"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"/path/to/client-cert.pem"</span><span class="p">;</span>
<span class="n">params</span><span class="p">[</span><span class="s">"tlsKeyFile"</span><span class="p">]</span>  <span class="o">=</span> <span class="s">"/path/to/client-key.pem"</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">setTlsTrustCertsFilePath</span><span class="p">(</span><span class="n">certfile</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">setTlsAllowInsecureConnection</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="n">AuthenticationPtr</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">pulsar</span><span class="o">::</span><span class="n">AuthFactory</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">"/path/to/libauthtls.so"</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">setAuth</span><span class="p">(</span><span class="n">auth</span><span class="p">);</span>

<span class="n">Client</span> <span class="n">client</span><span class="p">(</span><span class="s">"pulsar+ssl://my-broker.com:6651"</span><span class="p">,</span><span class="n">config</span><span class="p">);</span>
</code></pre>
</div>

      </section>
    </article>

    <nav class="toc-bar hidden-sm-down col-md-2 col-lg-2">
      
      <div id="toc">
        <h4>The Pulsar C++ client</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <footer class="footer">
  <div class="container">
    <p class="text-center">&copy; Apache Foundation 2017</p>
  </div>
</footer>


    
  </body>
</html>
